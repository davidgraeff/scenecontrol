{
   "validate_doc_update": "function(newDoc, savedDoc, userCtx) {\n  function require(field, type, message) {\n    message = message || 'Document must have a ' + field;\n    if (newDoc[field] === undefined || newDoc[field] == null) throw({forbidden : message});\n    if (type && typeof newDoc[field] != type)\n        throw({forbidden : message + ' of type ' + type});\n  };\n\n  if(newDoc.plugin_ && newDoc.plugin_ == \"time\"){\n     require(\"member_\");\n     require(\"type_\");\n     if(newDoc.type_ == 'event' && newDoc.member_ == \"timeperiodic\") {\n       require(\"time\"); require(\"days\");\n     } else if(newDoc.type_ == 'event' && newDoc.member_ == \"timedate\") {\n       require(\"time\"); require(\"date\");\n     } else {\n        throw({forbidden : \"Time plugin: need member (timeperiodic,timedate) and type (event,condition)\"});\n     }\n  }\n}",
   "language": "javascript",
   "views": {
       "plugin_time_periodic": {
           "map": "function(doc) {        if (doc.type_ && doc.plugin_ && doc.method_ && doc.type_=='event' &&            doc.plugin_=='time' && doc.method_ == 'timeperiodic')\n             emit(doc.collection_, doc);        }"
       },
       "plugin_time_date": {
           "map": "function(doc) {        if (doc.type_ && doc.plugin_ && doc.method_ && doc.type_=='event' &&            doc.plugin_=='time' && doc.method_ == 'datetime')             emit(doc.collection_, doc);        }"
       }
   }
}
